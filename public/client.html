<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>
	</title>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.css" />
	<style>
		/* App custom styles */
		  
		body, div.content {
			height: 100%;
		}
		  
		td {
			padding: 0px 10px 5px 0px;
			vertical-align: top;	
		}
	</style>
	<script src="http://www.google.com/jsapi" type="text/javascript"></script>        
	<script type="text/javascript">
		google.load("maps", "3", {'other_params':'sensor=true'});
		google.load("jquery", "1.7");
	</script>
		
	<script src="http://code.jquery.com/mobile/1.0.1/jquery.mobile-1.0.1.min.js">
	</script>
	<script src="js/jquery.ui.map.full.min.js" type="text/javascript">
	</script>
	<!-- Analytics -->
	<script type="text/javascript">

	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-29879234-1']);
	  _gaq.push(['_trackPageview']);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>
</head>
<body>
	<div class="content" data-role="page" id="page1">
		<div data-theme="a" data-role="header">
			<h3>
				Destination
			</h3>
			<a data-role="button" data-transition="flip" href="#page2" class="ui-btn-right">
				Settings
			</a>
		</div>
		<div class="content" data-role="content">
			<div id="map_canvas" style="width:100%;height:90%"></div>
		</div>
	</div>
	
	<div data-role="page" id="page2">
		<div data-theme="a" data-role="header">
			<h3>
				Settings
			</h3>
			<a data-role="button" data-rel="back" data-direction="reverse" data-transition="slide" href="#page1">
				Back
			</a>
		</div>
		<div data-role="content">
			<div data-role="fieldcontain">
				<fieldset data-role="controlgroup" data-type="vertical">
					<legend>
						Size of your group:
					</legend>
					<input name="radiobuttons1" id="radio1" value="radio1" type="radio" selected="selected" checked="checked"/>
					<label for="radio1">
						1 person
					</label>
					<input name="radiobuttons1" id="radio2" value="radio2" type="radio" />
					<label for="radio2">
						2 persons
					</label>
					<input name="radiobuttons1" id="radio3" value="radio3" type="radio" />
					<label for="radio3">
						3 persons
					</label>
					<input name="radiobuttons1" id="radio4" value="radio4" type="radio" />
					<label for="radio4">
						4 persons
					</label>
				</fieldset>
			</div>
			<div class="ui-grid-a">
				<div class="ui-block-a">
					<p>
						Looking for<br /> Kimppis buddies?
					</p>
				</div>
				<div class="ui-block-b">
					<div data-role="fieldcontain">
						<fieldset data-role="controlgroup">
							<label for="toggleswitch1">
							</label>
							<select name="toggleswitch1" id="toggleswitch1" data-theme="" data-role="slider">
								<option value="off">
									No
								</option>
								<option value="on" selected="selected">
									Yes
								</option>
							</select>
						</fieldset>
					</div>
				</div>
			</div>
		</div>
	</div>
	
	<div data-role="page" id="page3">
		<div data-theme="a" data-role="header">
			<h3>
				My Kimppis
			</h3>
			<a data-role="button" data-direction="reverse" data-transition="slide" href="#page1">
				Back
			</a>
			<a data-role="button" data-transition="flip" href="#page7" class="ui-btn-right">
				Map
			</a>
		</div>
		<div data-role="content">
			<table>
				<tr><td><strong>From</strong></td><td id="from_address">Searching...</td></tr>
				<tr><td><strong>To</strong></td><td id="to_address">Searching...</td></tr>
				<tr><td></td><td></td></tr>
					
				<tr class="yksis"><td colspan="2"><h3>Waiting for Kimppis buddies to share a taxi with you!</h3></td></tr>
				   
				<tr class="kimppis" style="display:none">
					<td colspan="2"><h3>Found <span id="kimppises">?</span> Kimppis buddies to share a taxi with you!</h3></td>
				</tr>
				   
				<tr class="kimppis" style="display:none"><td></td><td></td></tr>
				<tr class="kimppis" style="display:none"><td><strong>Price</strong></td><td>
					<table>
						<tr>
							<td>Normal:</td>
							<td style="text-align:right;"><span id="normal_price">??</span> €</td>
						</tr>
						<tr>
							<td>Kimppis:</td>
							<td style="text-align:right;"><span id="kimppis_price">??</span> €</td>
						</tr>
						<tr style="text-align:right;">
							<td style="border-top: solid 1px black;"><strong>You save:</strong></td>
							<td style="border-top: solid 1px black;"><strong><span id="saved_price">??</span> €</strong></td>
						</tr>
					</table>
					</td>
				</tr>
			</table>
			<a class="kimppis" style="display:none;max-width: 200px;" data-role="button" data-transition="slide" href="#page4">
				Accept
			</a>
		</div>
	</div>

	<div data-role="page" id="page4">
		<div data-theme="a" data-role="header">
			<h3>
				Find buddies
			</h3>
			<a data-role="button" data-direction="reverse" data-transition="slide" href="#page3">
				Back
			</a>
		</div>
		<div data-role="content">
			<img src="img/kimppis02.png" alt="" />
			<h3>Please lift your phone to find your buddies!</h3>
			<a data-role="button" data-transition="slide" href="#page5">
				Ready!
			</a>
		</div>
	</div>

	<div data-role="page" id="page5">
		<div data-theme="a" data-role="header">
			<h3>
				Find buddies
			</h3>
			<a data-role="button" data-direction="reverse" data-transition="slide" href="#page4">
				Back
			</a>
		</div>
		<div data-role="content">
			<a data-transition="slide" href="#page6"><img src="img/kimppis-flash.gif" alt="" /></a>
		</div>
	</div>

	<div data-role="page" id="page6">
		<div data-theme="a" data-role="header">
			<h3>
				Fare breakdown
			</h3>
			<a data-role="button" data-direction="reverse" data-transition="slide" href="#page5">
				Back
			</a>
			<a data-role="button" data-transition="flip" href="#page7" class="ui-btn-right">
				Route
			</a>
		</div>
		<div data-role="content">
			<h3>Destinations</h3>
			<table id="route_summary_table" style="width: 100%;">
			</table>
			<p>
				<a href="https://docs.google.com/spreadsheet/viewform?formkey=dHZ3NXZ5LTVOMDNTd01JdjVneHNnQWc6MQ">Give feedback!</a>
			</p>
		</div>
	</div>

	<div class="content" data-role="page" id="page7">
		<div data-theme="a" data-role="header">
			<h3>
				Route
			</h3>
			<a data-role="button" data-rel="back" data-direction="reverse" data-transition="slide" href="#page6">
				Back
			</a>
		</div>
		<div class="content"  data-role="content">
			<div class="content" data-role="content">
				<div class="content" id="route_map_canvas" style="width:100%;height:100%"></div>
			</div>
		</div>
	</div>

	<script>
		// Constants
		var SERVER = 'http://kimppis.dy.fi:80/rest'
		//var SERVER = 'http://marvin.dy.fi:80/rest'
		
		// Variables
		var persons = 1;
		var finder = true;
		
		var position_latLng = null;
		var destination_latLng = null;
		
		var directionsService;
		var directionsRenderer;
		
		var own_index = null;
		var route = null;
		var route_points = [];
		var total_data = {}
		var directions_result = null;
		var notification_hash = "";
		
		var costs = [];
		var cost_index = 0;
		
		/*
		 * 
		 * Page 1 (Map)
		 */
		 $('#page1').live("pageshow", function() {
			$('#map_canvas').gmap( { center: getLatLng(), 
									 zoom: 11, 
				  					 mapTypeControl: false,
				  					 keyboardShortcuts: false,
				  					 panControl: false,
				  					 rotateControl: false,
				  					 scaleControl: false,
									 streetViewControl: false,
									 callback: 
				function (map) {
					// Add location
					if ( navigator.geolocation ) {
						watch = navigator.geolocation.watchPosition ( 
							function( position ) { 
								// Get position
								position_latLng = new google.maps.LatLng(position.coords.latitude, 
																			 position.coords.longitude);
								
								// Set position
								$('#map_canvas').gmap('clear', 'markers');
								$('#map_canvas').gmap('addMarker', 
									{ 'title'	: 'You are here!', 
									  'bound'	: false, 
									  'position': position_latLng,
									  'icon'	: new google.maps.MarkerImage('img/blue-dot.png', null, null, new google.maps.Point(25, 25))
								  	}
								);
								map.panTo( position_latLng );
							}
						);
					}
					
					// Add event listener
					google.maps.event.addListener(map, 'click', function (event) {
						// Store positions, go to next page
						destination_latLng = event.latLng;
						$.mobile.changePage($('#page3'));
					});
				}
			});
		});
				
		$('#page1').live("pagehide", function() {
			if ( navigator.geolocation ) {
				navigator.geolocation.clearWatch(watch);
            }
		});
				
		$('#page1').live("pagecreate", function() {
			var watch;
		});
		
		
		/*
		 * 
		 * Page 2 (Settings)
		 */
		$('#radio1').change(function(event) {persons = 1});
		$('#radio2').change(function(event) {persons = 2});
		$('#radio3').change(function(event) {persons = 3});
		$('#radio4').change(function(event) {persons = 4});
		
		$('#toggleswitch1').change(function(event) {finder = !finder});
		
		/*
		 * 
		 * Page 3 (Route data)
		 */
        $('#page3').live("pageshow", function() {
			if (!position_latLng || !destination_latLng) {
				$.mobile.changePage($('#page1'));
				return;
			}
			
			if (route) {
				return;
			}
			
			// Update form / to
			latLng_to_string(destination_latLng, function(to_address) {
				$('#to_address').html(to_address);
				
				var route;
				var request;
				// Get route data
				$.ajax({
					type: 'PUT',
					url: SERVER + "/request",
					data: JSON.stringify({origin: [position_latLng.lng(), position_latLng.lat()],
					   	destination: [destination_latLng.lng(), destination_latLng.lat()],
				   	  	persons: persons,
						destination_string: to_address
					}), 
					contentTypeString: 'application/json',
					dataType: 'json',
					success: function(route_data) {
						route = route_data.route;
						request = route_data.request;
						handle_route(route_data);
					},
					fail: function(jqXHR, textStatus) {
						console.log(textStatus);
					}
				});
				
				// Poll for updates
				setTimeout(function() { poll_request(route, request); }, 5000);
			});
		});
		
		poll_request = function(route, request) {
			$.ajax({
				type: 'GET',
				url: SERVER + "/route/" + route._id,
				dataType: 'json',
				success: function(route_data) {
					route_data.request = request;
					handle_route(route_data);
					setTimeout(function() { poll_request(route, request); }, 5000);
				},
				fail: function(jqXHR, textStatus) {
					console.log(textStatus);
					setTimeout(function() { poll_request(route, request); }, 5000);
				}
			});
		}
		
		$('#page3').live("pagecreate", function() {
			directionsService = new google.maps.DirectionsService();
		});
		
		
		latLng_to_string = function(latlng, callback) {
			if (!latlng) {
				callback("Unkown");
				return;
			}
			
			var geocoder = new google.maps.Geocoder();
			geocoder.geocode({'latLng': latlng}, function(results, status) {
				if (status == google.maps.GeocoderStatus.OK) {
					if (results[0]) {
						var components = results[0].address_components;
						var hood = "";
						var postal_code = "";
						var city = "";
						for (i in components) {
							switch(components[i].types[0]) {
							case 'postal_code':
								postal_code = components[i].long_name;
								hood = postalCodeMapping[postal_code];
								break;
							case 'administrative_area_level_3':
								city = components[i].long_name;
								break;
							}
						}
						
						var string =  postal_code + " " + hood + ", " + city;
						callback(string);
					}
				} else {
					console.log("Geocoder failed due to: " + status);
				}
			});
		}
		
		handle_route = function(route_data) {
			// Get data
			route = route_data.route;
			var request = route_data.request;
			var requests = route_data.requests;
			var stand = route.stand;
			
			// Get own id
			for (var i = 0 ; i < requests.length ; i++) {
				if (request.id == requests[i].id) {
					own_index = i;
					break;
				}
			}
			
			// Populate view
			$('#from_address').html(stand.name);
			
			if (requests.length >= 2) {
				$('#page3 .yksis').hide();
				$('#page3 .kimppis').show();
				$('#page3 #kimppises').html(requests.length -1);
			} else {
				$('#page3 .yksis').show();
				$('#page3 .kimppis').hide();
			}
			
			// Calculate prices
			var waypoints = [];
			for (var i = 0; i < requests.length-1; i++) {
				waypoints.push({location: new google.maps.LatLng(requests[i].destination[1], requests[i].destination[0]),
								stopover:true
								});
			}
			var request = {
		    	origin: position_latLng,
		      	destination: new google.maps.LatLng(requests[requests.length-1].destination[1], requests[requests.length-1].destination[0]),
				waypoints: waypoints,
				optimizeWaypoints: true,
				provideRouteAlternatives: false,
				unitSystem: google.maps.UnitSystem.METRIC,
		      	travelMode: google.maps.TravelMode.DRIVING
		    };
			
			var distances = [];
			directionsService.route(request, function(result, status) {
			    if (status === google.maps.DirectionsStatus.OK) {
					directions_result = result;
					var legs = result.routes[0].legs;
					var order = result.routes[0].waypoint_order;
					for (var i = 0; i < legs.length; i++) {
						if (i !== legs.length-1) {
							distances[order[i]] = legs[i].distance.value;
						} else {
							distances[i] = legs[i].distance.value;
						}
					}
					
					delete request.waypoints;
					directionsService.route(request, function(result, status) {
						costs = calculate_costs(distances);
						
						route_points = [];
						var total_distance = 0;
						var total_cost = 0;
						for (var i = 0 ; i < costs.length ; i++) {
							route_points[i] = {
								request: requests[i],
								distance: distances[i],
								cost: costs[i]
							};
							total_distance += distances[i];
							total_cost += costs[i];
						}
						total_data.distance = total_distance;
						total_data.cost = total_cost;
						
						kimppis_cost = costs[own_index];
						normal_cost = calculate_costs([result.routes[0].legs[0].distance.value])[0];
						difference = normal_cost - kimppis_cost;
						
						// Update values
						$('#kimppis_price').html(Math.round(kimppis_cost*100)/100);
						$('#normal_price').html(Math.round(normal_cost*100)/100);
						$('#saved_price').html(Math.round(difference*100)/100);
					});
			    } else {
			    	console.log(status);
				}
			});
		}
		
		calculate_costs = function(distances) {
			var persons = distances.length;
			// Starting price
			var starting_price = start_price(Date.now());
			
			var price_per_km = persons <= 2 ? 1.43 : 1.72;
			var total_km_price = 0;
			var total_distance = 0;
			for (var i = 0; i < persons; i++) {
				total_distance += distances[i];
				total_km_price += distances[i] * price_per_km/1000;
			}
			
			// +10%
			km_price *= 1.10;
			
			var prices = [];
			for (var i = 0; i < persons; i++) {
				var km_price = total_km_price * distances[i] / total_distance;
				km_price = km_price || 0;
				prices[i] = km_price + (starting_price / persons);
			}
			
			return prices;
		}
		
		start_price = function(date) {
			// TODO: Compare with current date
			return 8.6;
		}
		
		/*
		 * 
		 * Page 6 (Summary)
		 */
		$('#page6').live("pageshow", function() {
			if (!route_points || !route_points.length) {
				$.mobile.changePage($('#page1'));
				return;
			}
			
			var persons = route_points.length;
			var table = $('#route_summary_table');
			table.empty();
			var buddy;
			var buddy_counter = 1;
			for (var i = 0 ; i < persons ; i++ ) {
				if (i == own_index) {
					buddy = "You";
				} else {
					buddy = "Buddy " + buddy_counter;
					buddy_counter += 1;
				}
				var route_point = route_points[i];
				var km = route_point.distance/1000;
				var cost = Math.round(route_point.cost*100)/100;
				var address = route_point.request.destination_string;
				
				table.append('<tr><td><strong>' + buddy + '</strong> (' + km + ' km)</td><td style="float:right;"><strong>' + 
														cost + ' €</strong></td></tr>');
				table.append('<tr><td colspan="2">' + address + '</td></tr>');
				table.append('<tr><td colspan="2"><hr /></td></tr>');
			}
			
			var total_km = total_data.distance / 1000;
			var total_cost = Math.round(total_data.cost*100)/100;
			table.append('<tr><td><strong>TOTAL</strong> ('+ total_km +' km)</td>'+
						 '<td style="float:right;"><strong>' + total_cost + ' €</strong></td></tr>');
			table.append('<tr><td></td><td></td></tr>');
		});
		 
 		/*
 		 * 
 		 * Page 7 (Route map)
 		 */
 		$('#page7').live("pageshow", function() {
			if (!directions_result) {
				$.mobile.changePage($('#page1'));
				return;
			}
			
			$('#route_map_canvas').gmap( { 'center': getLatLng(), 'callback': 
				function (map) {
					// Show directions
					if (directions_result) {
						directionsRenderer.setMap(map);
				        directionsRenderer.setDirections(directions_result);
					}
				}
			});
 		});
		
		$('#page7').live("pagecreate", function() {
			directionsRenderer = new google.maps.DirectionsRenderer();
			directionsRenderer.setOptions({
				draggable: false,
				hideRouteList: false,
			});
		});
		
		
 		/*
 		 * 
 		 * Helpers
 		 */
		
		function getLatLng() {
			if ( google.loader.ClientLocation != null ) {
				return new google.maps.LatLng(google.loader.ClientLocation.latitude, google.loader.ClientLocation.longitude);	
			}
			return new google.maps.LatLng(60.195132,24.933472);
		}
		
		var postalCodeMapping = {
			'00002': "Helsinki",
			'00010': "Postikeskus",
			'00100': "Kamppi, Etu-Töölö, Kaisaniemi, Hietaniemi, Kluuvi",
			'00102': "Eduskunta",
			'00120': "Punavuori, Hietalahti",
			'00130': "Kaartinkaupunki",
			'00140': "Kaivopuisto, Ullanlinna",
			'00150': "Hernesaari, Munkkisaari, Eira, Ullanlinna",
			'00160': "Katajanokka",
			'00170': "Kruununhaka",
			'00180': "Ruoholahti, Salmisaari, Lapinlahti",
			'00190': "Suomenlinna",
			'00200': "Lauttasaari",
			'00210': "Lauttasaari, Vattuniemi",
			'00220': "Jätkäsaari, Länsisatama",
			'00230': "Kivihaka",
			'00240': "Pasila, Ilmala",
			'00250': "Taka-Töölö, Laakso, Meilahti, Eläintarha",
			'00260': "Töölö",
			'00270': "Laakso, Pikku Huopalahti",
			'00280': "Ruskeasuo",
			'00290': "Meilahden sairaala",
			'00300': "Pikku Huopalahti",
			'00310': "Kivihaka",
			'00320': "Haaga, Etelä-Haaga",
			'00330': "Munkkiniemi",
			'00340': "Lehtisaari, Kaskisaari, Kuusisaari",
			'00350': "Munkkivuori, Talinranta",
			'00360': "Pajamäki",
			'00370': "Marttila, Reimarla, Pitäjänmäki",
			'00380': "Pitäjänmäki",
			'00390': "Konala",
			'00400': "Pohjois-Haaga",
			'00410': "Malminkartano",
			'00420': "Kannelmäki",
			'00430': "Hakuninmaa, Maununneva",
			'00440': "Lassila",
			'00500': "Sörnäinen",
			'00510': "Kallio",
			'00520': "Itä-Pasila",
			'00530': "Hakaniemi",
			'00540': "Sompasaari",
			'00550': "Hermanni",
			'00560': "Vanhakaupunki",
			'00570': "Kulosaari",
			'00580': "Sörnäinen",
			'00590': "Tahvonlahti",
			'00600': "Käpylä, Koskela",
			'00610': "Käpylä",
			'00620': "Metsälä",
			'00630': "Maunula",
			'00640': "Patola",
			'00650': "Veräjämäki",
			'00660': "Länsi-Pakila",
			'00670': "Paloheinä",
			'00680': "Itä-Pakila",
			'00690': "Torpparinmäki",
			'00700': "Torpparinmäki",
			'00710': "Pihlajamäki",
			'00720': "Pukinmäki",
			'00730': "Tapanila",
			'00740': "Suutarila",
			'00750': "Tapulikaupunki",
			'00760': "Heikinlaakso, Puistola",
			'00770': "Jakomäki",
			'00780': "Tapaninvainio",
			'00790': "Latokartano",
			'00800': "Herttoniemi",
			'00810': "Herttoniemenranta",
			'00820': "Roihuvuori",
			'00830': "Tammisalo",
			'00840': "Yliskylä",
			'00850': "Jollas",
			'00860': "Santahamina",
			'00870': "Hevossalmi",
			'00880': "Roihuvuori",
			'00890': "Östersundom",
			'00900': "Puotinharju",
			'00910': "Puotila",
			'00920': "Myllypuro",
			'00930': "Marjaniemi",
			'00940': "Kontula",
			'00950': "Vartioharju",
			'00960': "Vuosaari",
			'00970': "Mellunmäki",
			'00980': "Meri-Rastila",
			'00990': "Aurinkolahti",
			'02100': "Tapiola, Hakalehto",
			'02110': "Tapiola",
			'02120': "Suvikumpu, Hakalehto",
			'02130': "Pohjois-Tapiola, Koivu-Mankkaa, Pyhäristi",
			'02140': "Laajalahti, Laajaranta, Friisinmäki",
			'02150': "Otaniemi, Keilaniemi, Maari",
			'02160': "Westend",
			'02170': "Haukilahti",
			'02180': "Mankkaa, Seilimäki, Klovi, Taavinkylä",
			'02200': "Suvikumpu, Henttaa, Kokinkylä, Lystimäki, Piispankylä",
			'02210': "Puolarmetsä, Puolarmaari, Olari, Kuitinmäki, Piispankylä",
			'02230': "Matinkylä, Tiistilä, Nuottalahti, Nuottaniemi, Koivuniemi, Iirislahti",
			'02240': "Friisilä",
			'02260': "Kaitaa, Riilahti, Hyljelahti, Iivisniemi",
			'02270': "Eestinmäki, Hannus, Nuottalahti",
			'02280': "Eestinlaakso, Kukkumäki, Malminmäki",
			'02290': "Puolarmetsän sairaala",
			'02300': "Nöykkiö",
			'02320': "Kivenlahti",
			'02330': "Kattilalaakso",
			'02340': "Latokaski",
			'02360': "Soukka, Soukanranta",
			'02380': "Rämsö, Suvisaaristo",
			'02600': "Leppävaara, Ruusutorppa, Säteri, Perkkaa, Ruukinranta, Yhdyskunanmäki",
			'02610': "Kilo, Karamalmi, Kuninkainen",
			'02620': "Rastaala, Rastaspuisto, Karakallio, Leppäsilta",
			'02630': "Nihtisilta, Nuijala, Lansa",
			'02650': "Vallikallio, Mäkkylä, Puustellinmäki",
			'02660': "Lintuvaara",
			'02680': "Lehtovuori",
			'02710': "Viherlaakso",
			'02720': "Karakallio",
			'02730': "Laaksolahti",
			'02740': "Karhusuo, Bemböle",
			'02750': "Kuurinniitty, Sepänkylä",
			'02760': "Espoonkeskus",
			'02770': "Espoonkeskus",
			'02780': "Espoonkartano",
			'02810': "Gumböle, Hirvisuo",
			'02820': "Brobacka, Nuuksio",
			'02860': "Nuuksio",
			'02920': "Kalajärvi",
			'02940': "Lippajärvi",
			'02970': "Kalajärvi, Metsämaa",
			'02980': "Espoo",
			'01009': "Vantaa",
			'01200': "Nissas, Sotunki",
			'01230': "Vaarala, Kuussilta, Suurmetsä",
			'01260': "Kolohonka, Kuninkaanmäki, Itä-Hakkila",
			'01280': "Länsimäki, Rajakylä",
			'01300': "Koivuhaka, Simonkallio, Viertola, Kukkaketo",
			'01350': "Simonkylä, Malminiitty, Hiekkaharju",
			'01360': "Koivukylä, Rautkallio, Havukoski, Sahamäki",
			'01370': "Jokiniemi, Satomäki, Maarinkunnas, Stenkulla",
			'01380': "Kuusikko, Kanerva, Hakkila, Hakkilankallio, Porttipuisto",
			'01390': "Kylmäoja, Ilola, Harjusuo, Ruskeasanta",
			'01400': "Rekolanmäki, Asola, Rekola, Matari, Rekolanranta, Päiväkumpu",
			'01420': "Päiväkumpu, Rekolanranta",
			'01450': "Korkinmäki, Vähä-Muori, Vallinoja, Leppäkorpi, Korso",
			'01480': "Maarukanmetsä, Jokivarsi, Haapala",
			'01490': "Pohjois-Nikinmäki, Nikinmäki, Viirilä",
			'01510': "Virkamies, Veromies, Veromiehenkylä, Veromäki, Köyhämäki, Sandbacka, ",
			'01530': "Lentoasema",
			'01600': "Louhela, Jönsas, Kilteri",
			'01610': "Gruva, Silvola, Kaivoksela, Vaskipelto",
			'01620': "Tyttökumpu, Kivimäki, Martinlaakso",
			'01630': "Hämeenkylä, Backas, Långbacka, Linnainen",
			'01640': "Linnainen, Koivuvaara, Hämevaara",
			'01650': "Pellas, Vapaala, Rajatorppa",
			'01660': "Varisto",
			'01670': "Vantaanlaakso, Smeds, Viherkumpu, Perkiö",
			'01680': "Koivurinne, Askisto",
			'01690': "Ylästö, Tolkinmetsä, Tolkinkylä, Mansikkamäki",
			'01700': "Rauhala, Kannisto, Kivistö",
			'01710': "Pähikärinne",
			'01730': "Sotilaskorpi, Rajasilta, Lapinniitty, Petas, Vantaanpuisto",
			'01750': "Keimola",
			'01760': "Männikkö, Pirttiranta, Seutula, Koivikko, Tapola",
		}
		
		// Analytics
		$('[data-role=page]').live('pageshow', function (event, ui) {
		    try {
		        _gaq.push(['_setAccount', 'YOUR_GA_ID']);

		        hash = location.hash;

		        if (hash) {
		            _gaq.push(['_trackPageview', hash.substr(1)]);
		        } else {
		            _gaq.push(['_trackPageview']);
		        }
		    } catch(err) {
				console.log(err);
		    }
		});
		</script>
    </body>
</html>